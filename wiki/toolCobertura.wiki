#summary Cobertura de testes de unidade (Fábio Nogueira de Lucena)

= Introdução =

Testes de unidade são amplamente empregados atualmente. Não basta, contudo, simplesmente fazê-los. Um dos instrumentos também geralmente empregados com os testes de unidade é a verificação da cobertura do código testado pelos testes de unidade. O que significa isto? Verificar quanto do código testado é exercitado pelos testes de unidade. Por exemplo, podem ser feitos muitos testes de unidade mas que se concentram em parte específica do código, enquanto outras partes podem permanecer sem serem testadas. Ferramentas como Cobertura permitem que, após a execução dos testes de unidade, relatórios sejam gerados ressaltando o que foi exercitado ou não do código testado.

= Cobertura e Ant =

Abaixo segue parte de um arquivo build.xml (Ant) contendo alvos relevantes para o emprego da ferramenta Cobertura.

{{{
	<target name="compile" description="compila fontes">
		<mkdir dir="${build.dir}/classes" />
		<javac encoding="ISO-8859-1" srcdir="${src.dir}" destdir="${build.dir}/classes" debug="${compile.debug}">
			<classpath refid="projeto.classpath" />
		</javac>
	</target>

	<path id="cobertura.classpath">
		<path location="${cobertura.jar}" />
		<fileset dir="${cobertura.dir}/lib" includes="*.jar" />
	</path>

	<taskdef classpathref="cobertura.classpath" resource="tasks.properties"/>
	
	<target name="cobertura-instrument" depends="compile" description="instrumenta código para cobertura">
		<cobertura-instrument todir="${build.dir}/instrumented-classes" datafile="${build.dir}/cobertura.ser">
		    <fileset dir="${build.dir}/classes">
		        <include name="**/*.class"/>
		    </fileset>
		</cobertura-instrument>
	</target>
	
	<target name="set-debug-true">
		<property name="compile.debug" value="true"/>
	</target>
	
	<target name="set-debug-false">
		<property name="compile.debug" value="false"/>
	</target>		
	
	<target name="cobertura" depends="clean, set-debug-true, cobertura-instrument, test" description="gera relatório de cobertura">
	    <cobertura-report datafile="${build.dir}/cobertura.ser" srcdir="${src.dir}" destdir="${build.dir}/cobertura"/>
	</target>
}}}